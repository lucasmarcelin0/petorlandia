{% macro photo_cropper(file_field, rotation_field=None, zoom_field=None, offset_x_field=None, offset_y_field=None, image_url='', id_prefix='photo', size=240) %}
<div class="text-center">
  <div id="{{ id_prefix }}-container" class="img-thumbnail shadow-sm mb-2 position-relative overflow-hidden" style="width: {{ size }}px; height: {{ size }}px; border-radius: 1rem;">
    <img id="{{ id_prefix }}-img" src="{{ image_url }}" style="width:100%; height:100%; object-fit: cover; cursor: move;" alt="Foto">
  </div>
  <div class="mt-2" id="{{ id_prefix }}-controls">
    {{ file_field(class="form-control form-control-sm", id=id_prefix) }}
    <div class="d-flex justify-content-center gap-2 my-2">
      <button type="button" id="{{ id_prefix }}-rotate-left" class="btn btn-outline-secondary btn-sm" title="Girar 90° à esquerda"><i class="fas fa-undo"></i></button>
      <button type="button" id="{{ id_prefix }}-rotate-right" class="btn btn-outline-secondary btn-sm" title="Girar 90° à direita"><i class="fas fa-redo"></i></button>
      <button type="button" id="{{ id_prefix }}-zoom-out" class="btn btn-outline-secondary btn-sm" title="Diminuir zoom">-</button>
      <button type="button" id="{{ id_prefix }}-zoom-in" class="btn btn-outline-secondary btn-sm" title="Aumentar zoom">+</button>
    </div>
    {% if rotation_field %}{{ rotation_field(class='d-none', id=id_prefix + '-rotation') }}{% endif %}
    {% if zoom_field %}{{ zoom_field(class='d-none', id=id_prefix + '-zoom') }}{% endif %}
    {% if offset_x_field %}{{ offset_x_field(class='d-none', id=id_prefix + '-offset-x') }}{% endif %}
    {% if offset_y_field %}{{ offset_y_field(class='d-none', id=id_prefix + '-offset-y') }}{% endif %}
  </div>
</div>
<script>initPhotoCropper('{{ id_prefix }}');</script>
{% endmacro %}

