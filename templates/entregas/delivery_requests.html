{# templates/delivery_requests.html #}
{% extends "layout.html" %}

{% block main %}
<div class="container py-4">

  <h2 class="fw-bold mb-4">ðŸšš Minhas Entregas</h2>

  <div id="delivery-sections">
    {% include "entregas/_delivery_sections.html" %}
  </div>

  <div class="text-center mt-4">
    <a class="btn btn-outline-secondary" href="{{ url_for('delivery_archive_user') }}">
      <i class="fas fa-archive me-1"></i> Arquivadas: pedidos arquivados
    </a>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    async function refreshCounts() {
      try {
        const resp = await fetch('/api/delivery_counts');
        if (!resp.ok) return;
        const data = await resp.json();
        const mapping = {
          'available-count': data.available_total,
          'doing-count': data.doing,
          'done-count': data.done,
          'canceled-count': data.canceled,
        };
        Object.entries(mapping).forEach(([id, value]) => {
          const el = document.getElementById(id);
          if (el) {
            el.textContent = value;
          }
        });
      } catch (err) {
        console.error('Falha ao atualizar contadores', err);
      }
    }
    refreshCounts();
    setInterval(refreshCounts, 10000);
  });
</script>
{% endblock %}
