<!-- templates/imprimir_consulta.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Consulta de {{ animal.name }}</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 2cm;
      color: #000;
      font-size: 12pt;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1em;
    }

    .header img {
      max-height: 80px;
    }

    .clinica-nome {
      text-align: center;
      font-size: 18pt;
      font-weight: bold;
    }

    h2 {
      text-align: center;
      font-size: 16pt;
      margin: 0 0 20px;
      border-bottom: 2px solid #000;
      padding-bottom: 8px;
    }

    .section-title {
      font-weight: bold;
      margin-top: 1.2em;
      margin-bottom: 0.4em;
    }

    .assinatura {
      margin-top: 60px;
      text-align: center;
    }

    .assinatura span {
      display: block;
      margin-top: 5px;
    }

    footer {
      margin-top: 60px;
      font-size: 10pt;
      text-align: center;
      border-top: 1px solid #aaa;
      padding-top: 10px;
    }

    @media print {
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body>

  <div class="no-print" style="margin-bottom: 1em;">
    <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
    <button onclick="abrirAssinatura()" style="margin-left: 5px;">üîè Assinar</button>
    <button onclick="abrirDrive()" style="margin-left: 5px;">üìÇ Abrir no Drive</button>
    <button onclick="enviarWhatsApp()" style="margin-left: 5px;">üì± WhatsApp</button>
    <a href="{{ url_for('consulta_direct', animal_id=animal.id) }}"
       style="margin-left: 15px;">‚Üê Voltar</a>
  </div>

  {% if clinica and clinica.logotipo %}
    {% set logo_src = clinica.logotipo if clinica.logotipo.startswith('http')
                       else url_for('static', filename='uploads/clinicas/' + clinica.logotipo) %}
    <div class="header">
      <img src="{{ logo_src }}" alt="Logo da cl√≠nica">
      <div class="clinica-nome">{{ clinica.nome }}</div>
      <img src="{{ logo_src }}" alt="Logo da cl√≠nica">
    </div>
  {% endif %}

  <h2>Resumo da Consulta Cl√≠nica</h2>

  <div class="section-title">Animal:</div>
  <p>
    Nome: {{ animal.name }}<br>
    Esp√©cie: {{ animal.species }}<br>
    Ra√ßa: {{ animal.breed or '‚Äî' }}<br>
    Sexo: {{ animal.sex or '‚Äî' }}<br>
    Peso: {{ animal.peso or '‚Äî' }} kg<br>
    Microchip: {{ animal.microchip_number or '‚Äî' }}
  </p>

  <div class="section-title">Tutor:</div>
  <p>
    Nome: {{ tutor.name }}<br>
    CPF: {{ tutor.cpf or '‚Äî' }}<br>
    Endere√ßo: {{ tutor.address or '‚Äî' }}
  </p>

  <div class="section-title">Queixa Principal:</div>
  <p>{{ consulta.queixa_principal or '‚Äî' }}</p>

  <div class="section-title">Hist√≥rico Cl√≠nico:</div>
  <p>{{ consulta.historico_clinico or '‚Äî' }}</p>

  <div class="section-title">Exame F√≠sico:</div>
  <p>{{ consulta.exame_fisico or '‚Äî' }}</p>

  <div class="section-title">Conduta:</div>
  <p>{{ consulta.conduta or '‚Äî' }}</p>

  <div class="assinatura">
    ___________________________________________<br>
    {{ current_user.name }}<br>
    CRMV: {{ current_user.veterinario.crmv if current_user.veterinario else '‚Äî' }}
  </div>

  {% if clinica %}
  <footer>
    {{ clinica.nome }} ‚Äì {{ clinica.endereco }}<br>
    {% if clinica.telefone %}Telefone: {{ clinica.telefone }} ‚Äì {% endif %}
    {% if clinica.email %}Email: {{ clinica.email }} ‚Äì {% endif %}
    {% if clinica.cnpj %}CNPJ: {{ clinica.cnpj }}{% endif %}
  </footer>
  {% endif %}
<script>
  function abrirAssinatura() {
    if (confirm('Abrir p√°gina de assinatura agora?')) {
      window.open('https://assinador.iti.br/assinatura/index.xhtml', '_blank');
    }
  }

  function abrirDrive() {
    const driveUrl = 'https://drive.google.com/viewerng/viewer?embedded=1&url=' +
      encodeURIComponent(window.location.href);
    window.open(driveUrl, '_blank');
  }

  function enviarWhatsApp() {
    const numero = "{{ ''.join(ch for ch in tutor.phone if ch.isdigit()) if tutor.phone else '' }}";
    if (!numero) {
      alert('N√∫mero de telefone do tutor n√£o informado.');
      return;
    }
    const mensagem = encodeURIComponent('Segue o resumo da consulta: ' + window.location.href);
    window.open(`https://api.whatsapp.com/send?phone=${numero}&text=${mensagem}`, '_blank');
  }
</script>
</body>
</html>
