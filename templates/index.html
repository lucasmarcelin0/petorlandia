{% extends "layout.html" %}

{% block main %}
<div class="container text-center">

    {% if current_user.is_authenticated %}
        <!-- Ãrea pessoal -->
        <div class="card shadow-sm p-4 rounded-4 mt-5 mb-4 card-surface-muted">
            <h5 class="mb-2">Bem-vindo(a)! O que vocÃª deseja fazer hoje?</h5>
            <p class="text-muted small">Escolha um atalho abaixo para ir direto Ã  aÃ§Ã£o desejada.</p>

            <div class="row justify-content-center g-4">
                <!-- Lottie: Add Animal -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_ghs9bthn.json"
                                       background="transparent" speed="1" class="lottie-cta" loop autoplay role="img"
                                       aria-label="AnimaÃ§Ã£o ilustrando o cadastro de um novo animal"></lottie-player>
                        <img src="{{ url_for('static', filename='icons/add-animal.svg') }}" alt="IlustraÃ§Ã£o de cadastro de um novo animal" class="lottie-fallback d-none">
                    </div>
                    <a href="{{ url_for('add_animal') }}" class="btn btn-outline-success rounded-pill shadow-sm px-4 py-2"
                       data-bs-toggle="tooltip" title="Abre o formulÃ¡rio para registrar um novo pet.">
                        â• Cadastrar novo animal
                    </a>
                </div>

                <!-- Lottie: List Animals -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <lottie-player src="https://assets4.lottiefiles.com/packages/lf20_qp1q7mct.json"
                                       background="transparent" speed="1" class="lottie-cta" loop autoplay role="img"
                                       aria-label="AnimaÃ§Ã£o representando a listagem de animais"></lottie-player>
                        <img src="{{ url_for('static', filename='icons/list-animals.svg') }}" alt="IlustraÃ§Ã£o representando a lista de animais" class="lottie-fallback d-none">
                    </div>
                    <a href="{{ url_for('list_animals') }}" class="btn btn-outline-primary rounded-pill shadow-sm px-4 py-2"
                       data-bs-toggle="tooltip" title="Mostra a lista completa para visualizar e filtrar pets.">
                        ğŸ“‹ Ver todos os animais
                    </a>
                </div>

                <!-- Lottie: Health -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_ksixj2kx.json"
                                       background="transparent" speed="1" class="lottie-cta" loop autoplay role="img"
                                       aria-label="AnimaÃ§Ã£o sobre o plano de saÃºde para pets"></lottie-player>
                        <img src="{{ url_for('static', filename='icons/health-plan.svg') }}" alt="IlustraÃ§Ã£o do plano de saÃºde para pets" class="lottie-fallback d-none">
                    </div>
                    <a href="{{ url_for('plano_saude_overview') }}" class="btn btn-outline-info rounded-pill shadow-sm px-4 py-2"
                       data-bs-toggle="tooltip" title="Mostra detalhes e contrataÃ§Ã£o do plano de saÃºde.">
                        â¤ï¸ Plano de SaÃºde Pet
                    </a>
                </div>

                <!-- Lottie: Store -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_sGqAqL.json"
                                       background="transparent" speed="1" class="lottie-cta" loop autoplay role="img"
                                       aria-label="AnimaÃ§Ã£o destacando a loja pet"></lottie-player>
                        <img src="{{ url_for('static', filename='icons/store.svg') }}" alt="IlustraÃ§Ã£o que destaca a loja pet" class="lottie-fallback d-none">
                    </div>
                    <a href="{{ url_for('loja') }}"
                       class="btn rounded-pill shadow-sm loja-pet-filled px-4 py-2"
                       data-bs-toggle="tooltip"
                       title="Abre a loja para comprar produtos e agendar entregas.">
                       ğŸ›ï¸ Loja Pet
                    </a>


                </div>
            </div>
        </div>
    {% else %}
        <!-- Visitante nÃ£o autenticado -->
        <div class="card shadow-lg p-5 rounded-4 mt-5 card-surface-white">
            <div class="text-center">
                <img src="{{ url_for('static', filename='logo_pet.png') }}"
                     alt="Logo PetOrlÃ¢ndia"
                     class="mb-4 logo-img mx-auto">
            </div>

            <p class="lead">
                PetOrlÃ¢ndia Ã© um espaÃ§o completo para quem ama e cuida dos animais. Aqui vocÃª pode adotar, doar, agendar atendimentos veterinÃ¡rios e encontrar tudo o que seu pet precisa â€” com carinho, responsabilidade e praticidade.
            </p>
            
            <div class="d-flex justify-content-center gap-3 mt-4">
                
                <a href="{{ url_for('register') }}" class="btn btn-outline-success rounded-pill px-4 py-2">ğŸ§‘ Criar Conta</a>
               
                <a href="{{ url_for('login_view') }}" class="btn btn-outline-primary rounded-pill px-4 py-2">ğŸ” Entrar</a>
            </div>
        </div>
    {% endif %}

    {% if current_user.is_authenticated and (current_user.worker == 'colaborador' or is_active_veterinarian) %}
    <!-- Ãrea profissional -->
        <div class="card shadow-lg p-4 rounded-4 mb-5 card-surface-white">
            <h5 class="mb-2">Ãrea profissional</h5>
            <p class="text-muted small">Atalhos para gerenciar atendimentos, animais e tutores.</p>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="{{ url_for('novo_animal') }}" class="btn btn-outline-primary rounded-pill shadow-sm px-4 py-2"
                   data-bs-toggle="tooltip" title="Abre a lista de animais para editar vÃ­nculos e dados.">
                    ğŸ¶ Animais
                </a>

                <a href="{{ url_for('tutores') }}" class="btn btn-outline-secondary rounded-pill shadow-sm px-4 py-2"
                   data-bs-toggle="tooltip" title="Visualiza tutores e permite atualizar contatos.">
                    ğŸ‘¥ Tutores
                </a>

                {% if current_user.worker == 'colaborador' or (is_active_veterinarian and current_user.veterinario) %}
                <a href="{{ url_for('appointments') }}"
                   class="btn btn-outline-warning rounded-pill shadow-sm px-4 py-2"
                   data-bs-toggle="tooltip" title="Abre a agenda para marcar e revisar atendimentos.">
                    ğŸ—“ï¸ Agenda
                </a>
                {% endif %}
            </div>
        </div>
    {% endif %}

    {% if current_user.is_authenticated %}
        {% set owned_clinics = current_user.clinicas or [] %}
        {% set has_admin_role = current_user.role in ['admin', 'master'] %}
        {% set admin_worker_roles = ['gestor', 'administrador', 'admin_clinica', 'master'] %}
        {% set has_admin_worker = current_user.worker in admin_worker_roles %}
        {% set owner_with_access = owned_clinics|length > 0 and can_access_accounting %}
        {% if has_admin_role or has_admin_worker or owner_with_access %}
        <div class="card shadow-lg p-4 rounded-4 mb-5 accounting-card card-surface-white">
            <h5 class="mb-2 text-center">Contabilidade</h5>
            <p class="text-muted small text-center">Escolha um painel para acompanhar receitas, pagamentos e obrigaÃ§Ãµes.</p>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="/contabilidade/financeiro" class="btn accounting-btn accounting-btn--finance">
                    <i class="fa-solid fa-chart-line"></i>
                    <span>Financeiro</span>
                </a>
                <a href="/contabilidade/pagamentos" class="btn accounting-btn accounting-btn--payments">
                    <i class="fa-solid fa-briefcase"></i>
                    <span>Pagamentos / PJs</span>
                </a>
                <a href="/contabilidade/obrigacoes" class="btn accounting-btn accounting-btn--obligations">
                    <i class="fa-solid fa-file-invoice-dollar"></i>
                    <span>ObrigaÃ§Ãµes</span>
                </a>
            </div>
        </div>
        {% endif %}
    {% endif %}

    {% if current_user.is_authenticated and current_user.worker == 'delivery' %}
    <!-- Ãrea de Entregas -->
        <div class="card shadow-lg p-4 rounded-4 mb-5 card-surface-white">
            <h5 class="mb-2">Ãrea de Entregas</h5>
            <p class="text-muted small">Acesse pedidos e confirme entregas rapidamente.</p>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="{{ url_for('list_delivery_requests') }}" class="btn btn-outline-secondary rounded-pill shadow-sm px-4 py-2">
                    ğŸšš SolicitaÃ§Ãµes
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.lottie-wrapper').forEach((wrapper) => {
            const player = wrapper.querySelector('lottie-player');
            const fallback = wrapper.querySelector('.lottie-fallback');

            if (!player || !fallback) {
                return;
            }

            const showFallback = () => {
                fallback.classList.remove('d-none');
                player.classList.add('d-none');
            };

            const showPlayer = () => {
                fallback.classList.add('d-none');
                player.classList.remove('d-none');
            };

            let isReady = false;

            const markReady = () => {
                isReady = true;
                showPlayer();
            };

            player.addEventListener('load', markReady);
            player.addEventListener('ready', markReady);
            player.addEventListener('error', () => {
                isReady = false;
                showFallback();
            });

            setTimeout(() => {
                if (!isReady) {
                    showFallback();
                }
            }, 4000);
        });
    });
</script>
{% endblock %}
