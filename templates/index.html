{% extends "layout.html" %}

{% block main %}
<style>
    .accounting-card .accounting-btn {
        border-radius: 999px;
        color: #fff;
        border: none;
        padding: 0.75rem 1.75rem;
        min-width: 190px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        font-weight: 600;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .accounting-card .accounting-btn i {
        font-size: 1rem;
    }

    .accounting-card .accounting-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
        color: #fff;
    }

    .lottie-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
    }

    .lottie-box {
        position: relative;
        height: 120px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .lottie-box lottie-player,
    .lottie-box .lottie-fallback {
        height: 100px;
        width: auto;
        max-width: 180px;
    }

    .lottie-fallback {
        object-fit: contain;
    }
</style>
<div class="container text-center">

    {% if current_user.is_authenticated %}
        <!-- √Årea pessoal -->
        <div class="card shadow-sm p-4 rounded-4 mt-5 mb-4" style="background: #f8f9fa;">
            <h5 class="mb-4">Bem-vindo(a)! O que voc√™ deseja fazer hoje?</h5>

            <div class="row justify-content-center g-4">
                <!-- Lottie: Add Animal -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <div class="lottie-box">
                            <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_ghs9bthn.json"
                                           background="transparent" speed="1" loop autoplay aria-label="Cadastrar novo animal">
                            </lottie-player>
                            <img src="{{ url_for('static', filename='icons/add-animal.svg') }}" alt="Ilustra√ß√£o de cadastro de animal"
                                 class="lottie-fallback d-none" loading="lazy" aria-hidden="true">
                        </div>
                        <a href="{{ url_for('add_animal') }}" class="btn btn-outline-success rounded-pill shadow-sm px-4 py-2"
                           data-bs-toggle="tooltip" title="Cadastre um novo animal na plataforma.">
                            ‚ûï Cadastrar novo animal
                        </a>
                    </div>
                </div>

                <!-- Lottie: List Animals -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <div class="lottie-box">
                            <lottie-player src="https://assets4.lottiefiles.com/packages/lf20_qp1q7mct.json"
                                           background="transparent" speed="1" loop autoplay aria-label="Listar animais">
                            </lottie-player>
                            <img src="{{ url_for('static', filename='icons/list-animals.svg') }}" alt="Ilustra√ß√£o de listagem de animais"
                                 class="lottie-fallback d-none" loading="lazy" aria-hidden="true">
                        </div>
                        <a href="{{ url_for('list_animals') }}" class="btn btn-outline-primary rounded-pill shadow-sm px-4 py-2"
                           data-bs-toggle="tooltip" title="Veja todos os animais dispon√≠veis.">
                            üìã Ver todos os animais
                        </a>
                    </div>
                </div>

                <!-- Lottie: Health -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <div class="lottie-box">
                            <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_ksixj2kx.json"
                                           background="transparent" speed="1" loop autoplay aria-label="Plano de sa√∫de pet">
                            </lottie-player>
                            <img src="{{ url_for('static', filename='icons/health-plan.svg') }}" alt="Ilustra√ß√£o de plano de sa√∫de pet"
                                 class="lottie-fallback d-none" loading="lazy" aria-hidden="true">
                        </div>
                        <a href="{{ url_for('plano_saude_overview') }}" class="btn btn-outline-info rounded-pill shadow-sm px-4 py-2"
                           data-bs-toggle="tooltip" title="Conhe√ßa nosso plano de sa√∫de para pets.">
                            ‚ù§Ô∏è Plano de Sa√∫de Pet
                        </a>
                    </div>
                </div>

                <!-- Lottie: Store -->
                <div class="col-md-3">
                    <div class="lottie-wrapper">
                        <div class="lottie-box">
                            <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_sGqAqL.json"
                                           background="transparent" speed="1" loop autoplay aria-label="Loja pet">
                            </lottie-player>
                            <img src="{{ url_for('static', filename='icons/pet-store.svg') }}" alt="Ilustra√ß√£o de loja pet"
                                 class="lottie-fallback d-none" loading="lazy" aria-hidden="true">
                        </div>
                        <a href="{{ url_for('loja') }}"
                           class="btn rounded-pill shadow-sm loja-pet-filled px-4 py-2"
                           data-bs-toggle="tooltip"
                           title="Acesse nossa loja para encontrar tudo que seu pet precisa.">
                           üõçÔ∏è Loja Pet
                        </a>
                    </div>


                </div>
            </div>
        </div>
    {% else %}
        <!-- Visitante n√£o autenticado -->
        <div class="card shadow-lg p-5 rounded-4 mt-5" style="background: white;">
            <div class="text-center">
                <img src="{{ url_for('static', filename='logo_pet.png') }}"
                     alt="Logo PetOrl√¢ndia"
                     class="mb-4 logo-img mx-auto">
            </div>

            <p class="lead">
                PetOrl√¢ndia √© um espa√ßo completo para quem ama e cuida dos animais. Aqui voc√™ pode adotar, doar, agendar atendimentos veterin√°rios e encontrar tudo o que seu pet precisa ‚Äî com carinho, responsabilidade e praticidade.
            </p>
            
            <div class="d-flex justify-content-center gap-3 mt-4">
                
                <a href="{{ url_for('register') }}" class="btn btn-outline-success rounded-pill px-4 py-2">üßë Criar Conta</a>
               
                <a href="{{ url_for('login_view') }}" class="btn btn-outline-primary rounded-pill px-4 py-2">üîê Entrar</a>
            </div>
        </div>
    {% endif %}

    {% if current_user.is_authenticated and (current_user.worker == 'colaborador' or is_active_veterinarian) %}
    <!-- √Årea profissional -->
        <div class="card shadow-lg p-4 rounded-4 mb-5" style="background: #ffffff;">
            <h5 class="mb-4">√Årea profissional</h5>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="{{ url_for('novo_animal') }}" class="btn btn-outline-primary rounded-pill shadow-sm px-4 py-2"
                   data-bs-toggle="tooltip" title="Gerencie os animais vinculados a tutores.">
                    üê∂ Animais
                </a>

                <a href="{{ url_for('tutores') }}" class="btn btn-outline-secondary rounded-pill shadow-sm px-4 py-2"
                   data-bs-toggle="tooltip" title="Veja os tutores cadastrados.">
                    üë• Tutores
                </a>

                {% if current_user.worker == 'colaborador' or (is_active_veterinarian and current_user.veterinario) %}
                <a href="{{ url_for('appointments') }}"
                   class="btn btn-outline-warning rounded-pill shadow-sm px-4 py-2"
                   data-bs-toggle="tooltip" title="Administre sua agenda de atendimentos.">
                    üóìÔ∏è Agenda
                </a>
                {% endif %}
            </div>
        </div>
    {% endif %}

    {% if current_user.is_authenticated %}
        {% set owned_clinics = current_user.clinicas or [] %}
        {% set has_admin_role = current_user.role in ['admin', 'master'] %}
        {% set admin_worker_roles = ['gestor', 'administrador', 'admin_clinica', 'master'] %}
        {% set has_admin_worker = current_user.worker in admin_worker_roles %}
        {% set owner_with_access = owned_clinics|length > 0 and can_access_accounting %}
        {% if has_admin_role or has_admin_worker or owner_with_access %}
        <div class="card shadow-lg p-4 rounded-4 mb-5 accounting-card" style="background: #ffffff;">
            <h5 class="mb-4 text-center">Contabilidade</h5>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="/contabilidade/financeiro" class="btn accounting-btn" style="background-color: #4A90E2;">
                    <i class="fa-solid fa-chart-line"></i>
                    <span>Financeiro</span>
                </a>
                <a href="/contabilidade/pagamentos" class="btn accounting-btn" style="background-color: #6f42c1;">
                    <i class="fa-solid fa-briefcase"></i>
                    <span>Pagamentos / PJs</span>
                </a>
                <a href="/contabilidade/obrigacoes" class="btn accounting-btn" style="background-color: #f4b400; color: #4a3c00;">
                    <i class="fa-solid fa-file-invoice-dollar"></i>
                    <span>Obriga√ß√µes</span>
                </a>
            </div>
        </div>
        {% endif %}
    {% endif %}

    {% if current_user.is_authenticated and current_user.worker == 'delivery' %}
    <!-- √Årea de Entregas -->
        <div class="card shadow-lg p-4 rounded-4 mb-5" style="background: #ffffff;">
            <h5 class="mb-4">√Årea de Entregas</h5>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="{{ url_for('list_delivery_requests') }}" class="btn btn-outline-secondary rounded-pill shadow-sm px-4 py-2">
                    üöö Solicita√ß√µes
                </a>
            </div>
        </div>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.lottie-wrapper').forEach(function (wrapper) {
            var player = wrapper.querySelector('lottie-player');
            var fallback = wrapper.querySelector('.lottie-fallback');
            var animationLoaded = false;

            if (!fallback) {
                return;
            }

            function showFallback() {
                if (animationLoaded) {
                    return;
                }
                fallback.classList.remove('d-none');
                fallback.setAttribute('aria-hidden', 'false');
                if (player) {
                    player.classList.add('d-none');
                    player.setAttribute('aria-hidden', 'true');
                }
            }

            function markLoaded() {
                animationLoaded = true;
                fallback.classList.add('d-none');
                fallback.setAttribute('aria-hidden', 'true');
                if (player) {
                    player.classList.remove('d-none');
                    player.setAttribute('aria-hidden', 'false');
                }
            }

            if (player) {
                player.addEventListener('load', markLoaded);
                player.addEventListener('error', showFallback);
            }

            setTimeout(function () {
                if (!animationLoaded) {
                    showFallback();
                }
            }, 4000);
        });
    });
</script>
{% endblock %}
