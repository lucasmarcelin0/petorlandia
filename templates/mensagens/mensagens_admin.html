{% extends "layout.html" %}
{% block main %}
<div class="container py-4"
     data-admin-messages
     data-fetch-url="{{ url_for('mensagens_admin') }}"
     data-poll-interval="10000"
     data-per-page="{{ per_page }}">
  <div class="card shadow-sm mb-4" data-thread-kind="animals" data-next-page="{{ animais_next or '' }}">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="mb-0">Mensagens sobre Animais</h2>
        <div class="spinner-border text-primary d-none" role="status" aria-hidden="true" data-loading></div>
      </div>
      <ul class="list-group mt-3" data-list>
        {% if mensagens_animais %}
          {% with threads=mensagens_animais, kind='animals' %}
            {% include 'mensagens/_admin_threads.html' %}
          {% endwith %}
        {% endif %}
      </ul>
      <p class="text-muted {% if mensagens_animais %}d-none{% endif %} mt-3" data-empty>
        Nenhuma mensagem recebida.
      </p>
      <div class="text-center mt-3">
        <button type="button" class="btn btn-outline-primary {% if not animais_next %}d-none{% endif %}" data-load-more>
          Carregar mais
        </button>
      </div>
    </div>
  </div>

  <div class="card shadow-sm" data-thread-kind="general" data-next-page="{{ gerais_next or '' }}">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="mb-0">Mensagens Gerais</h2>
        <div class="spinner-border text-primary d-none" role="status" aria-hidden="true" data-loading></div>
      </div>
      <ul class="list-group mt-3" data-list>
        {% if mensagens_gerais %}
          {% with threads=mensagens_gerais, kind='general' %}
            {% include 'mensagens/_admin_threads.html' %}
          {% endwith %}
        {% endif %}
      </ul>
      <p class="text-muted {% if mensagens_gerais %}d-none{% endif %} mt-3" data-empty>
        Nenhuma mensagem recebida.
      </p>
      <div class="text-center mt-3">
        <button type="button" class="btn btn-outline-primary {% if not gerais_next %}d-none{% endif %}" data-load-more>
          Carregar mais
        </button>
      </div>
    </div>
  </div>

  <noscript>
    <div class="alert alert-warning mt-4">Ative o JavaScript para atualizar automaticamente as conversas.</div>
  </noscript>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script type="module" src="{{ url_for('static', filename='js/mensagens_admin.js') }}"></script>
{% endblock %}
