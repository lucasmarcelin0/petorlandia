<div class="card border-0 shadow-lg rounded-4 mb-5">
  <div class="card-header bg-primary text-white rounded-top-4 d-flex justify-content-between align-items-center">
    <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i> Gerenciar Horários</h5>
    <div>
      <button id="openScheduleModal" class="btn btn-light btn-sm me-2" type="button">
        <i class="bi bi-pencil"></i> Editar Horário
      </button>
      <button class="btn btn-success btn-sm" data-bs-toggle="collapse" data-bs-target="#newAppointmentForm">
        <i class="bi bi-plus-circle"></i> Nova Consulta
      </button>
    </div>
  </div>

  <div class="collapse" id="newAppointmentForm">
    <div class="card-body p-4">
      {% if form %}
      <form method="POST">
        {{ form.hidden_tag() }}
        <div class="row g-3">
          <div class="col-md-6">
            {{ form.animal_id.label(class="form-label fw-semibold") }}
            {{ form.animal_id(class="form-select") }}
          </div>
          <div class="col-md-6">
            {{ form.veterinario_id.label(class="form-label fw-semibold") }}
            {{ form.veterinario_id(class="form-select") }}
          </div>
        </div>

        <div class="row g-3 mt-2">
          <div class="col-md-6">
            {{ form.date.label(class="form-label fw-semibold") }}
            {{ form.date(class="form-control", type="date") }}
          </div>
          <div class="col-md-6">
            {{ form.time.label(class="form-label fw-semibold") }}
            <select
              id="{{ form.time.id }}"
              name="{{ form.time.name }}"
              class="form-select"
              data-placeholder="Selecione um horário"
              data-empty-text="Sem horários disponíveis"
              data-current-time="{{ form.time.data.strftime('%H:%M') if form.time.data else '' }}"
              {% if form.time.flags.required %}required{% endif %}
            >
              {% if form.time.data %}
                {% set current_time = form.time.data.strftime('%H:%M') %}
                <option value="{{ current_time }}" selected>{{ current_time }}</option>
              {% else %}
                <option value="" selected disabled>Selecione um horário</option>
              {% endif %}
            </select>
          </div>
        </div>

        <div class="mt-3">
          {{ form.kind.label(class="form-label fw-semibold") }}
          {{ form.kind(class="form-select") }}
        </div>

        <div class="mt-3">
          {{ form.reason.label(class="form-label fw-semibold") }}
          {{ form.reason(class="form-control", rows=3, placeholder="Motivo da consulta...") }}
        </div>

        <div class="d-grid mt-4">
          {{ form.submit(class="btn btn-success btn-lg rounded-pill") }}
        </div>
      </form>
      <div class="mt-4">
        <div class="d-flex flex-column flex-lg-row align-items-lg-center gap-3 mb-3">
          <div class="d-flex align-items-center flex-wrap gap-2">
            <h6 class="fw-bold mb-0">
              <i class="bi bi-calendar3 me-2"></i>Disponibilidade do Veterinário
            </h6>
            <span
              class="badge rounded-pill text-bg-light small fw-normal"
              data-schedule-summary
              aria-live="polite"
            >
              Selecione um profissional para visualizar a agenda.
            </span>
          </div>
          <div class="d-flex flex-wrap align-items-center gap-2 ms-lg-auto">
            <div class="d-flex align-items-center gap-2 small text-muted" data-schedule-legend>
              <span class="d-inline-flex align-items-center gap-1">
                <i class="bi bi-check-circle-fill text-success"></i>
                Disponível
              </span>
              <span class="d-inline-flex align-items-center gap-1 ms-2">
                <i class="bi bi-x-circle-fill text-danger"></i>
                Indisponível
              </span>
              <span class="d-inline-flex align-items-center gap-1 ms-2">
                <i class="bi bi-slash-circle-fill text-secondary"></i>
                Fora do expediente
              </span>
            </div>
            <button
              class="btn btn-outline-primary btn-sm"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#scheduleOverviewCollapse"
              aria-expanded="true"
              aria-controls="scheduleOverviewCollapse"
              data-show-label="Mostrar agenda"
              data-hide-label="Ocultar agenda"
            >
              Ocultar agenda
            </button>
          </div>
        </div>
        <div class="d-flex flex-column flex-xl-row align-items-xl-center gap-3 mb-3">
          <div class="d-flex align-items-center gap-2 small text-muted">
            <i class="bi bi-calendar-week me-1"></i>
            <span data-schedule-week-label aria-live="polite">
              Aguardando seleção de profissional.
            </span>
          </div>
          <div class="d-flex flex-wrap align-items-center gap-2 ms-xl-auto">
            <div class="btn-group btn-group-sm" role="group" aria-label="Navegação da agenda semanal">
              <button type="button" class="btn btn-outline-secondary" data-schedule-week-prev>
                <i class="bi bi-chevron-left"></i>
                <span class="d-none d-sm-inline ms-1">Semana anterior</span>
              </button>
              <button type="button" class="btn btn-outline-secondary" data-schedule-week-today>
                Hoje
              </button>
              <button type="button" class="btn btn-outline-secondary" data-schedule-week-next>
                <span class="d-none d-sm-inline me-1">Próxima semana</span>
                <i class="bi bi-chevron-right"></i>
              </button>
            </div>
            <div class="d-flex align-items-center gap-2">
              <label for="schedulePeriodFilter" class="form-label small text-muted mb-0">Período</label>
              <select
                id="schedulePeriodFilter"
                class="form-select form-select-sm w-auto"
                data-schedule-period-filter
              >
                <option value="all">Todos</option>
                <option value="morning">Manhã</option>
                <option value="afternoon">Tarde</option>
                <option value="evening">Noite</option>
              </select>
            </div>
          </div>
        </div>
        <div class="collapse show" id="scheduleOverviewCollapse">
          <div id="schedule-overview" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 small"></div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
