<div class="container py-4">
        <div class="page-header">
            <h1 class="h3 mb-0 text-gray-800"><i class="fas fa-calendar-alt me-2"></i>Agendamentos</h1>
        </div>

        {% if appointments_grouped %}
            {% for day, items in appointments_grouped %}
                <div class="day-header">
                    <i class="fas fa-calendar-day me-2"></i>{{ day|format_datetime_brazil('%A, %d/%m/%Y') }}
                </div>
                
                {% for appt in items %}
                    <div class="appointment-card scheduled" onclick="window.location='{{ url_for('edit_appointment', appointment_id=appt.id) }}'">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-2">
                                    <div class="time-display">
                                        <i class="far fa-clock me-1"></i>
                                        {{ appt.scheduled_at|format_datetime_brazil('%H:%M') }}
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="animal-name">
                                        <i class="fas fa-paw me-2"></i>{{ appt.animal.name }}
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="vet-name">
                                        <i class="fas fa-user-md me-2"></i>{{ appt.veterinario.user.name }}
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <span class="status-badge status-{{ appt.status }}">
                                        {% if appt.status == 'scheduled' %}A fazer{% endif %}
                                        {% if appt.status == 'completed' %}Realizada{% endif %}
                                        {% if appt.status == 'canceled' %}Cancelada{% endif %}
                                    </span>
                                </div>
                                <div class="col-md-3">
                                    <div class="actions-container">
                                        <a href="{{ url_for('ficha_animal', animal_id=appt.animal_id) }}" class="btn btn-icon btn-primary" title="Ficha do Animal">
                                            <i class="fas fa-file-medical"></i>
                                        </a>
                                        <a href="{{ url_for('ficha_tutor', tutor_id=appt.tutor_id) }}" class="btn btn-icon btn-secondary" title="Ficha do Tutor">
                                            <i class="fas fa-user"></i>
                                        </a>
                                        {% if current_user.worker in ['veterinario', 'colaborador'] %}
                                        <a href="{{ url_for('consulta_direct', animal_id=appt.animal_id) }}" class="btn btn-icon btn-success" title="Iniciar Consulta">
                                            <i class="fas fa-stethoscope"></i>
                                        </a>
                                        {% endif %}
                                        <a href="{{ url_for('edit_appointment', appointment_id=appt.id) }}" class="btn btn-icon btn-info" title="Propor novo horário">
                                            <i class="fas fa-sync-alt"></i>
                                        </a>
                                        
                                        <form method="POST" action="{{ url_for('update_appointment_status', appointment_id=appt.id) }}" class="form-confirm">
                                            {% if csrf_token is defined %}{{ csrf_token() }}{% endif %}
                                            <input type="hidden" name="status" value="completed">
                                            <button class="btn btn-icon btn-success" title="Marcar como realizada">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </form>
                                        
                                        <form method="POST" action="{{ url_for('update_appointment_status', appointment_id=appt.id) }}" class="form-confirm">
                                            {% if csrf_token is defined %}{{ csrf_token() }}{% endif %}
                                            <input type="hidden" name="status" value="canceled">
                                            <button class="btn btn-icon btn-warning" title="Cancelar">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </form>
                                        
                                        <form method="POST" action="{{ url_for('update_appointment_status', appointment_id=appt.id) }}" class="form-confirm">
                                            {% if csrf_token is defined %}{{ csrf_token() }}{% endif %}
                                            <input type="hidden" name="status" value="scheduled">
                                            <button class="btn btn-icon btn-secondary" title="Marcar como a fazer">
                                                <i class="fas fa-clock"></i>
                                            </button>
                                        </form>
                                        
                                        <form method="POST" action="{{ url_for('delete_appointment', appointment_id=appt.id) }}" class="form-confirm" data-confirm="Excluir este agendamento?">
                                            {% if csrf_token is defined %}{{ csrf_token() }}{% endif %}
                                            <button class="btn btn-icon btn-danger" title="Excluir">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="far fa-calendar-times"></i>
                <h3>Nenhum agendamento encontrado</h3>
                <p>Não há agendamentos para exibir no momento.</p>
            </div>
        {% endif %}
</div>

<script>
    // Adiciona confirmação para exclusão
    document.addEventListener('DOMContentLoaded', function() {
        const deleteForms = document.querySelectorAll('form[data-confirm]');

        deleteForms.forEach(form => {
            form.addEventListener('submit', function(e) {
                const message = this.getAttribute('data-confirm');
                if (!confirm(message)) {
                    e.preventDefault();
                }
            });
        });

        // Adiciona classes de status aos cards
        const appointmentCards = document.querySelectorAll('.appointment-card');
        appointmentCards.forEach(card => {
            const statusBadge = card.querySelector('.status-badge');
            if (statusBadge) {
                if (statusBadge.classList.contains('status-scheduled')) {
                    card.classList.add('scheduled');
                } else if (statusBadge.classList.contains('status-completed')) {
                    card.classList.add('completed');
                } else if (statusBadge.classList.contains('status-canceled')) {
                    card.classList.add('canceled');
                }
            }
        });
    });
</script>
