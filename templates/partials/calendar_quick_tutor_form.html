{% set form_id = form_id|default('calendar-quick-tutor-form') %}
{% set show_intro = show_intro|default(True) %}
{% if show_intro %}
  {% set header_id = heading_id|default(form_id ~ '-heading') %}
{% else %}
  {% set header_id = heading_id if heading_id is defined else None %}
{% endif %}

<form
  id="{{ form_id }}"
  method="POST"
  action="{{ url_for('tutores') }}"
  class="js-tutor-form"
  data-sync="true"
  {% if header_id %}aria-labelledby="{{ header_id }}"{% endif %}
>
  {% if show_intro %}
  <div class="d-flex flex-column flex-md-row align-items-md-center gap-2 mb-3">
    <h5 id="{{ header_id }}" class="mb-0">
      <i class="bi bi-person-plus me-2"></i> Cadastro rápido de tutor
    </h5>
    <span class="text-muted small">
      Preencha os dados essenciais para registrar um tutor sem sair da agenda.
    </span>
  </div>
  {% endif %}
  <div class="row g-3">
    <div class="col-md-6">
      <label for="{{ form_id }}-name" class="form-label">Nome <span class="text-danger">*</span></label>
      <input
        type="text"
        class="form-control"
        id="{{ form_id }}-name"
        name="tutor_name"
        placeholder="Nome completo"
        required
      >
    </div>
    <div class="col-md-6">
      <label for="{{ form_id }}-email" class="form-label">E-mail <span class="text-danger">*</span></label>
      <input
        type="email"
        class="form-control"
        id="{{ form_id }}-email"
        name="tutor_email"
        placeholder="nome@email.com"
        required
      >
    </div>
    <div class="col-md-4">
      <label for="{{ form_id }}-phone" class="form-label">Telefone</label>
      <input
        type="tel"
        class="form-control"
        id="{{ form_id }}-phone"
        name="tutor_phone"
        placeholder="(00) 00000-0000"
        inputmode="tel"
      >
    </div>
    <div class="col-md-4">
      <label for="{{ form_id }}-cpf" class="form-label">CPF</label>
      <input
        type="text"
        class="form-control"
        id="{{ form_id }}-cpf"
        name="tutor_cpf"
        placeholder="000.000.000-00"
        inputmode="numeric"
      >
    </div>
    <div class="col-md-4">
      <label for="{{ form_id }}-dob" class="form-label">Data de nascimento</label>
      <input
        type="date"
        class="form-control"
        id="{{ form_id }}-dob"
        name="tutor_date_of_birth"
      >
    </div>
    <div class="col-12">
      <label for="{{ form_id }}-notes" class="form-label">Observações</label>
      <textarea
        id="{{ form_id }}-notes"
        class="form-control"
        name="tutor_notes"
        rows="2"
        placeholder="Informações adicionais importantes para a equipe"
      ></textarea>
    </div>
  </div>
  <div class="d-flex flex-column flex-sm-row gap-2 justify-content-end mt-4">
    <a class="btn btn-outline-secondary" href="{{ url_for('tutores') }}" target="_blank" rel="noopener">
      <i class="bi bi-box-arrow-up-right me-1"></i> Abrir página completa
    </a>
    <button type="submit" class="btn btn-primary" data-submit-label>
      <i class="bi bi-save me-1"></i> Salvar tutor
    </button>
  </div>
</form>

<script>
(function() {
  const form = document.getElementById('{{ form_id }}');
  if (!form) {
    return;
  }
  form.addEventListener('submit', function() {
    const submitBtn = form.querySelector('[data-submit-label]');
    if (submitBtn && !submitBtn.dataset.submitting) {
      submitBtn.dataset.submitting = 'true';
      submitBtn.dataset.original = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>Salvando...';
      submitBtn.disabled = true;
    }
  });
})();
</script>
