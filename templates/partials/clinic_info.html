<!-- partials/clinic_info.html -->
{% from 'components/logo.html' import clinic_logo %}
<div class="card shadow-lg border-0 rounded-3 mb-4">
  <div class="card-body">
    <div class="row align-items-center">
      {% if clinica.logotipo %}
        <div class="col-md-4 text-center mb-3 mb-md-0">
          {{ clinic_logo(clinica) }}
        </div>
      {% endif %}
      <div class="{% if clinica.logotipo %}col-md-8{% else %}col-12{% endif %}">
        <h2 class="fw-bold mb-3 text-center text-md-start">{{ clinica.nome }}</h2>
        <div class="text-start">
          {% if clinica.endereco %}
            <p><i class="fas fa-map-marker-alt text-danger me-2"></i><strong>Endereço:</strong> {{ clinica.endereco }}</p>
          {% endif %}
          {% if clinica.telefone %}
            <p><i class="fas fa-phone-alt text-success me-2"></i><strong>Telefone:</strong> {{ clinica.telefone }}</p>
          {% endif %}
          {% if clinica.email %}
            <p><i class="fas fa-envelope text-primary me-2"></i><strong>Email:</strong> {{ clinica.email }}</p>
          {% endif %}
        </div>

        {% if pode_editar %}
          <button class="btn btn-sm btn-outline-primary mt-3" onclick="toggleEditInfo()">Editar</button>
          <div id="edit-info" class="mt-3" style="display:none;">
            <form method="post" enctype="multipart/form-data" class="row g-3">
              {{ clinic_form.hidden_tag() }}
              <div class="col-md-6">{{ clinic_form.nome.label }} {{ clinic_form.nome(class="form-control") }}</div>
              <div class="col-md-6">{{ clinic_form.cnpj.label }} {{ clinic_form.cnpj(class="form-control") }}</div>
              <div class="col-md-12">{{ clinic_form.endereco.label }} {{ clinic_form.endereco(class="form-control") }}</div>
              <div class="col-md-6">{{ clinic_form.telefone.label }} {{ clinic_form.telefone(class="form-control") }}</div>
              <div class="col-md-6">{{ clinic_form.email.label }} {{ clinic_form.email(class="form-control") }}</div>
              <div class="col-md-12">
                {{ clinic_form.logotipo.label }}
                {{ photo_cropper(clinic_form.logotipo, clinic_form.photo_rotation, clinic_form.photo_zoom, clinic_form.photo_offset_x, clinic_form.photo_offset_y, clinica.logotipo, 150, 'clinic_logo', 'user') }}
              </div>
              <div class="col-12">
                {{ clinic_form.submit(class="btn btn-primary") }}
              </div>
            </form>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% if show_clinic_metrics %}
  {% set prescricao_url = None %}
  {% if animais_adicionados %}
    {% set prescricao_url = url_for('consulta_direct', animal_id=animais_adicionados[0].id) + '#historico-prescricoes' %}
  {% endif %}
  <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-3 mb-4">
    <div class="col">
      <div class="card h-100 border-0 shadow-sm position-relative">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="rounded-circle bg-danger text-white d-inline-flex align-items-center justify-content-center" style="width:3rem; height:3rem;">
              <i class="fa-solid fa-paw"></i>
            </span>
            <small class="text-muted text-uppercase fw-semibold">Animais</small>
          </div>
          <h3 class="fw-bold mb-1">{{ clinic_metrics.animals or 0 }}</h3>
          <p class="text-muted small mb-3">cadastrados</p>
          <a class="small fw-semibold text-decoration-none text-primary mt-auto" href="{{ url_for('clinic_detail', clinica_id=clinica.id) }}#animais">
            Ver animais <i class="fa-solid fa-arrow-right-long ms-1"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card h-100 border-0 shadow-sm position-relative">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="rounded-circle bg-info text-white d-inline-flex align-items-center justify-content-center" style="width:3rem; height:3rem;">
              <i class="fa-solid fa-user-group"></i>
            </span>
            <small class="text-muted text-uppercase fw-semibold">Tutores</small>
          </div>
          <h3 class="fw-bold mb-1">{{ clinic_metrics.tutors or 0 }}</h3>
          <p class="text-muted small mb-3">ativos</p>
          <a class="small fw-semibold text-decoration-none text-primary mt-auto" href="{{ url_for('clinic_detail', clinica_id=clinica.id) }}#tutores">
            Ver tutores <i class="fa-solid fa-arrow-right-long ms-1"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card h-100 border-0 shadow-sm position-relative">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="rounded-circle bg-success text-white d-inline-flex align-items-center justify-content-center" style="width:3rem; height:3rem;">
              <i class="fa-solid fa-calendar-check"></i>
            </span>
            <small class="text-muted text-uppercase fw-semibold">Consultas</small>
          </div>
          <h3 class="fw-bold mb-1">{{ clinic_metrics.future_appointments or 0 }}</h3>
          <p class="text-muted small mb-3">próximas</p>
          <a class="small fw-semibold text-decoration-none text-primary mt-auto" href="{{ url_for('clinic_detail', clinica_id=clinica.id) }}#agendamentos">
            Ver agenda <i class="fa-solid fa-arrow-right-long ms-1"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card h-100 border-0 shadow-sm position-relative">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="rounded-circle bg-warning text-dark d-inline-flex align-items-center justify-content-center" style="width:3rem; height:3rem;">
              <i class="fa-solid fa-prescription-bottle-medical"></i>
            </span>
            <small class="text-muted text-uppercase fw-semibold">Receitas</small>
          </div>
          <h3 class="fw-bold mb-1">{{ clinic_metrics.open_prescriptions or 0 }}</h3>
          <p class="text-muted small mb-3">abertas</p>
          {% if prescricao_url %}
            <a class="small fw-semibold text-decoration-none text-primary mt-auto" href="{{ prescricao_url }}">
              Ver prescrições <i class="fa-solid fa-arrow-right-long ms-1"></i>
            </a>
          {% else %}
            <span class="small text-muted mt-auto" aria-disabled="true">Cadastre um animal para acessar</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endif %}

<!-- Horários -->
<div class="card shadow-sm border-0 rounded-3 mb-4">
  <div class="card-header bg-light">
    <h5 class="mb-0"><i class="far fa-clock me-2"></i>Horários de Atendimento</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table align-middle table-hover">
        <thead class="table-light">
          <tr>
            <th>Dia</th>
            <th>Abre</th>
            <th>Fecha</th>
            {% if pode_editar %}<th>Ações</th>{% endif %}
          </tr>
        </thead>
        <tbody>
          {% for h in horarios %}
            <tr>
              <td>{{ h.dia_semana }}</td>
              <td><span class="badge bg-success-subtle text-dark">{{ h.hora_abertura.strftime('%H:%M') }}</span></td>
              <td><span class="badge bg-danger-subtle text-dark">{{ h.hora_fechamento.strftime('%H:%M') }}</span></td>
              {% if pode_editar %}
                <td>
                  <form method="post" action="{{ url_for('delete_clinic_hour', clinica_id=clinica.id, horario_id=h.id) }}" class="d-inline">
                    {{ form.csrf_token }}
                    <button type="submit" class="btn btn-sm btn-outline-danger"
                            onclick="return confirm('Excluir este horário?');">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </form>
                </td>
              {% endif %}
            </tr>
          {% else %}
            <tr>
              <td colspan="{% if pode_editar %}4{% else %}3{% endif %}" class="text-center text-muted">
                Nenhum horário cadastrado.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if pode_editar %}
      <button class="btn btn-sm btn-outline-primary mt-3" onclick="toggleEditHours()">Editar</button>
      <div id="edit-hours" class="mt-3" style="display:none;">
        <form method="post" class="row g-3">
          {{ form.hidden_tag() }}
          <div class="col-md-12">
            {{ form.clinica_id.label }} {{ form.clinica_id(class="form-select") }}
          </div>
          <div class="col-md-12">
            {{ form.dias_semana.label }} {{ form.dias_semana(class="form-select", multiple=True, size=7) }}
            <div class="mt-2">
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectDays('all')">Todos</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectDays('weekday')">Dias Úteis</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectDays('weekend')">Fins de Semana</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectDays('clear')">Limpar</button>
            </div>
          </div>
          <div class="col-md-6">
            {{ form.hora_abertura.label }} {{ form.hora_abertura(class="form-control") }}
          </div>
          <div class="col-md-6">
            {{ form.hora_fechamento.label }} {{ form.hora_fechamento(class="form-control") }}
          </div>
          <div class="col-12">
            {{ form.submit(class="btn btn-primary") }}
          </div>
        </form>
      </div>
    {% endif %}
  </div>
</div>
