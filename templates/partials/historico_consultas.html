<h5 class="mt-4 mb-3">ğŸ“œ HistÃ³rico de Consultas</h5>

<style>
  .break-word-cell {
    word-break: break-word;
    white-space: pre-wrap;
    max-width: 250px;
  }
</style>

<div class="table-responsive">
  <table class="table table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>Data</th>
        <th>Queixa</th>
        <th>HistÃ³rico</th>
        <th>Exame FÃ­sico</th>
        <th>Conduta</th>
        <th class="text-end">AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody>
      {% for c in historico_consultas %}
      <tr id="consulta-{{ c.id }}">
        <td class="text-nowrap js-br-time" data-timestamp="{{ (c.finalizada_em or c.created_at)|isoformat_with_tz }}">
          {# Usa finalizada_em se disponÃ­vel, senÃ£o usa created_at #}
          {% set timestamp = c.finalizada_em or c.created_at %}
          <span class="js-br-date">{{ timestamp|format_datetime_brazil('%d/%m/%Y') }}</span><br>
          <small class="text-muted js-br-time-only">{{ timestamp|format_datetime_brazil('%H:%M') }}</small>
          {% if c.retorno_de_id %}
          <span class="badge bg-info ms-1">Retorno</span>
          {% endif %}
        </td>
        <td class="break-word-cell">{{ c.queixa_principal or 'â€”' }}</td>
        <td class="break-word-cell">{{ c.historico_clinico or 'â€”' }}</td>
        <td class="break-word-cell">{{ c.exame_fisico or 'â€”' }}</td>
        <td class="break-word-cell">{{ c.conduta or 'â€”' }}</td>
        <td class="text-end">
          <a href="{{ url_for('consulta_direct', animal_id=animal.id) }}?c={{ c.id }}"
            class="btn btn-outline-secondary btn-sm">âœï¸ Editar</a>
          <a href="{{ url_for('imprimir_consulta', consulta_id=c.id) }}" class="btn btn-outline-dark btn-sm">ğŸ–¨ï¸
            Imprimir</a>
          <form action="{{ url_for('deletar_consulta', consulta_id=c.id) }}" method="POST"
            class="d-inline delete-history-form" data-sync data-target="#historico-consultas"
            data-target-endpoint="{{ url_for('historico_consultas_partial', animal_id=animal.id, clinica_id=c.clinica_id) }}"
            data-confirm="Excluir esta consulta?">
            <button class="btn btn-outline-danger btn-sm">ğŸ—‘ï¸</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="6" class="text-center text-muted">Nenhuma consulta anterior.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>