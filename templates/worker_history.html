{% extends 'layout.html' %}
{% block main %}
<div class="container py-4">
  <h2 class="mb-4">Histórico de Entregas</h2>
  <h4>Tarefas Disponíveis</h4>
  <ul class="list-group mb-3">
    {% for r in available %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      Pedido #{{ r.order_id }}
      <form action="{{ url_for('accept_delivery', req_id=r.id) }}" method="post">
        <button class="btn btn-sm btn-primary">Aceitar</button>
      </form>
    </li>
    {% else %}
    <li class="list-group-item">Nenhuma tarefa disponível.</li>
    {% endfor %}
  </ul>
  <h4>Em Andamento</h4>
  <ul class="list-group mb-3">
    {% for r in doing %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      Pedido #{{ r.order_id }}
      <div>
        <button class="btn btn-sm btn-success d-inline" data-bs-toggle="modal" data-bs-target="#completeModal{{ r.id }}">Concluir</button>
        <button class="btn btn-sm btn-danger d-inline ms-2" data-bs-toggle="modal" data-bs-target="#cancelModal{{ r.id }}">Cancelar</button>

        <!-- Modal Concluir -->
        <div class="modal fade" id="completeModal{{ r.id }}" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Concluir entrega</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
              </div>
              <form action="{{ url_for('complete_delivery', req_id=r.id) }}" method="post">
                <div class="modal-body">Tem certeza que deseja concluir esta entrega?</div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Voltar</button>
                  <button class="btn btn-success">Concluir</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Modal Cancelar -->
        <div class="modal fade" id="cancelModal{{ r.id }}" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Cancelar entrega</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
              </div>
              <form action="{{ url_for('cancel_delivery', req_id=r.id) }}" method="post">
                <div class="modal-body">
                  <p class="mb-2">Tem certeza que deseja cancelar esta entrega?</p>
                  <div class="mb-2">
                    <label class="form-label">Motivo</label>
                    <textarea name="reason" class="form-control" rows="3"></textarea>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Voltar</button>
                  <button class="btn btn-danger">Cancelar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </li>
    {% else %}
    <li class="list-group-item">Nenhum pedido em andamento.</li>
    {% endfor %}
  </ul>
  <h4>Concluídos</h4>
  <ul class="list-group mb-3">
    {% for r in done %}
    <li class="list-group-item">Pedido #{{ r.order_id }} concluído</li>
    {% else %}
    <li class="list-group-item">Nada concluído ainda.</li>
    {% endfor %}
  </ul>
  <h4>Cancelados</h4>
  <ul class="list-group">
    {% for r in canceled %}
    <li class="list-group-item">Pedido #{{ r.order_id }} cancelado</li>
    {% else %}
    <li class="list-group-item">Nenhum cancelamento registrado.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
